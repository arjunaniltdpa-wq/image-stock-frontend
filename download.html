  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- =========================
        DYNAMIC SEO (Controlled by JS)
    ========================== -->
    <title id="seo-title">Pixeora Photo</title>

    <meta id="seo-desc" name="description" content="Download high-quality HD wallpapers & royalty-free stock images for free.">
    <meta id="seo-keywords" name="keywords"
          content="free hd wallpaper download, 4k image download, stock photo download, royalty free images, commercial use photos, aesthetic backgrounds, nature wallpapers, abstract wallpapers, USA UK Canada Australia India wallpaper download">

    <!-- Canonical (dynamic by JS) -->
    <link id="canonical-link" rel="canonical" href="">

    <!-- =========================
        PERFORMANCE BOOST
    ========================== -->
    <link rel="preload" href="/css/download.css" as="style">
    <link rel="stylesheet" href="/css/download.css">

    <link rel="preconnect" href="https://cdn.pixeora.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.pixeora.com">

    <link rel="preconnect" href="https://api.pixeora.com" crossorigin>
    <link rel="dns-prefetch" href="https://api.pixeora.com">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Marck+Script&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- =========================
        SOCIAL SHARING (Dynamic OG Tags)
    ========================== -->
    <meta id="og-title" property="og:title" content="Pixeora Image">
    <meta id="og-desc" property="og:description" content="Download full HD wallpapers & royalty-free stock images.">
    <meta id="og-image" property="og:image" content="">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Pixeora">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta id="twitter-title" name="twitter:title" content="Pixeora Image Download">
    <meta id="twitter-desc" name="twitter:description" content="Download high-quality wallpapers, 4K backgrounds, and stock images.">
    <meta id="twitter-image" name="twitter:image" content="">

    <!-- =========================
        STRUCTURED DATA (Dynamic ImageObject)
        Boosts Google Image ranking!
    ========================== -->
    <script type="application/ld+json" id="ld-json">
    {
      "@context": "https://schema.org",
      "@type": "ImageObject",
      "name": "",
      "description": "",
      "contentUrl": "",
      "thumbnailUrl": "",
      "creator": {
        "@type": "Organization",
        "name": "Pixeora"
      },
      "license": "https://pixeora.com/license"
    }
    </script>

  </head>

<head>
  <!-- (your head section UNCHANGED) -->
</head>

<body>

<header class="header">
  <div class="header-overlay">

    <a href="/index.html" class="logo">Pixeora</a>

    <div class="search-bar-wrapper">
      <div class="search-bar-border">
        <form class="search-bar" id="searchForm">
          <input type="text" id="searchInput" placeholder="Search Image" required>
          <button type="submit" class="search-icon">
            <img src="/images/search-icon.png" alt="Search" loading="lazy">
          </button>
        </form>
      </div>
    </div>

    <a href="/legal.html" class="legal-link-header">Legal & Policies</a>

  </div>
</header>


<div class="page-wrapper">

  <main>

    <div class="image-section">

      <div id="main-skeleton" class="skeleton"></div>

      <img id="download-image" src="" alt="Selected Image" loading="lazy" class="image-load">
      <h2 id="image-name">Loading...</h2>

      <div class="image-actions">
        <button class="info-btn"><i class="fas fa-info-circle"></i> Info</button>

        <a id="download-link" href="#" download>
          <button class="download-btn"><i class="fas fa-download"></i> Download</button>
        </a>
      </div>
    </div>

    <!-- ⭐ Updated Keywords Block -->
    <div class="keywords" id="keywords"></div>

  </main>
</div>


<!-- ⭐⭐⭐ NEW MASONRY RELATED ⭐⭐⭐ -->
<div class="related-section">
  <h2>Related Images</h2>

  <div class="masonry-grid" id="related-grid">
    <div class="masonry-col"></div>
    <div class="masonry-col"></div>
    <div class="masonry-col"></div>
    <div class="masonry-col"></div>
  </div>

</div>


<!-- INFO MODAL -->
<div id="infoModal" class="info-modal">
  <div class="info-content">
    <span class="close-btn">&times;</span>
    <h2>Image Information</h2>
    <ul>
      <li><strong>Name:</strong> <span id="info-name">-</span></li>
      <li><strong>Dimensions:</strong> <span id="info-dimensions">-</span></li>
      <li><strong>File Size:</strong> <span id="info-size">-</span></li>
      <li><strong>Format:</strong> <span id="info-format">-</span></li>
      <li><strong>License:</strong> Free to use for commercial and personal purposes</li>
    </ul>
  </div>
</div>



<script>
/* ---------------------------------- */
/* GLOBAL SETTINGS */
/* ---------------------------------- */
const API_BASE = "https://api.pixeora.com";

/* ---------------------------------- */
/* SEARCH FIX */
/* ---------------------------------- */

document.getElementById("searchForm").addEventListener("submit", (e) => {
  e.preventDefault();
  const q = document.getElementById("searchInput").value.trim();
  if (q) window.location.href = `search.html?query=${encodeURIComponent(q)}`;
});


/* ---------------------------------- */
/* IMAGE DETAILS */
/* ---------------------------------- */

const fullSlug = window.location.pathname.split("/photo/")[1] || "";

async function loadImageDetails() {
  try {
    const res = await fetch(`${API_BASE}/api/images/slug/${fullSlug}`);

    if (!res.ok) {
      document.getElementById("image-name").textContent = "Image Not Found.";
      return;
    }

    const img = await res.json();

    const displayUrl = `https://cdn.pixeora.com/${encodeURIComponent(img.fileName)}`;
    const mainImg = document.getElementById("download-image");

    mainImg.onload = () => {
      document.getElementById("main-skeleton").style.display = "none";
      mainImg.classList.add("image-loaded");
    };

    mainImg.src = displayUrl;
    document.getElementById("image-name").textContent = img.title || img.fileName;

    document.getElementById("download-link").href =
      `${API_BASE}/api/images/download/${encodeURIComponent(img.fileName)}`;

    window.__originalFileName = img.fileName;

    /* ⭐ KEYWORDS FIX */
    const wordList =
      img.keywords?.length ? img.keywords :
      img.tags?.length ? img.tags :
      [];

    document.getElementById("keywords").innerHTML =
      wordList.map(t =>
        `<span onclick="location.href='search.html?query=${encodeURIComponent(t)}'">${t}</span>`
      ).join("");

    const category = img.category || wordList[0];
    if (category) loadRelated(category);

  } catch (e) {
    document.getElementById("image-name").textContent = "Image Not Found.";
  }
}


/* ---------------------------------- */
/* RELATED IMAGES — MASONRY GRID */
/* ---------------------------------- */

async function loadRelated(keyword) {
  try {
    const res = await fetch(`${API_BASE}/api/search?q=${encodeURIComponent(keyword)}`);
    const json = await res.json();

    let images = Array.isArray(json) ? json : json.images || [];
    const cols = document.querySelectorAll("#related-grid .masonry-col");

    cols.forEach(col => (col.innerHTML = ""));
    let colIndex = 0;

    images.slice(0, 40).forEach((img) => {

      const thumb =
        img.thumbnailUrl ||
        `https://cdn.pixeora.com/${encodeURIComponent(img.fileName)}`;

      const card = document.createElement("div");
      card.classList.add("image-item");

      card.innerHTML = `
        <div class="image-wrapper">
          <div class="skeleton"></div>

          <a href="/photo/${img.slug}-${img._id}">
            <img 
              data-src="${thumb}"
              class="lazy-img image-load"
              alt="${img.alt || img.title}"
            >
          </a>

          <span class="download-overlay"
            onclick="window.location.href='${API_BASE}/api/images/download/${encodeURIComponent(img.fileName)}'">
          </span>
        </div>
      `;

      cols[colIndex].appendChild(card);
      colIndex = (colIndex + 1) % cols.length;
    });

    lazyLoadInit(); // homepage lazy loader

  } catch (e) {}
}


/* LAZY LOAD INIT */
function lazyLoadInit() {
  const lazyImages = document.querySelectorAll("img.lazy-img");

  const observer = new IntersectionObserver(
    (entries, obs) => {
      entries.forEach(entry => {
        if (!entry.isIntersecting) return;

        const img = entry.target;
        img.src = img.dataset.src;

        img.onload = () => {
          img.classList.add("image-loaded");
          img.closest(".image-wrapper").querySelector(".skeleton").remove();
        };

        img.classList.remove("lazy-img");
        obs.unobserve(img);
      });
    },
    { rootMargin: "300px 0px" }
  );

  lazyImages.forEach(img => observer.observe(img));
}



/* ---------------------------------- */
/* INFO MODAL (UNCHANGED) */
/* ---------------------------------- */

const modal = document.getElementById("infoModal");
const infoBtn = document.querySelector(".info-btn");
const closeBtn = document.querySelector(".close-btn");

infoBtn.onclick = async () => {
  modal.classList.add("active");

  const originalUrl = `https://cdn.pixeora.com/${encodeURIComponent(window.__originalFileName)}`;
  document.getElementById("info-name").textContent =
    document.getElementById("image-name").textContent;

  try {
    const tmp = new Image();
    tmp.src = originalUrl;
    await tmp.decode();

    document.getElementById("info-dimensions").textContent =
      `${tmp.naturalWidth} × ${tmp.naturalHeight}px`;

    const head = await fetch(originalUrl, { method: "HEAD" });
    const size = head.headers.get("content-length");

    document.getElementById("info-size").textContent =
      size ? (size / (1024 * 1024)).toFixed(2) + " MB" : "Unknown";

    const ext = originalUrl.split(".").pop().split("?")[0].toUpperCase();
    document.getElementById("info-format").textContent = ext;

  } catch (e) {
    document.getElementById("info-dimensions").textContent = "-";
    document.getElementById("info-size").textContent = "-";
    document.getElementById("info-format").textContent = "-";
  }
};

closeBtn.onclick = () => modal.classList.remove("active");
window.onclick = (e) => { if (e.target === modal) modal.classList.remove("active"); };

loadImageDetails();
</script>

