<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pixeora Photo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="css/photo.css">
</head>

<body>

<header class="photo-header">
  <a href="index.html" class="logo">Pixeora</a>
</header>

<main class="photo-container">

  <!-- MAIN IMAGE -->
  <div class="photo-box">
    <img id="main-image" alt="Loading...">
  </div>

  <!-- DETAILS -->
  <div class="photo-details">
    <h1 id="photo-title"></h1>
    <p id="photo-description"></p>

    <div class="tag-box" id="tag-box"></div>

    <button id="download-btn" class="download-btn">Download</button>
  </div>

</main>

<section class="related-section">
  <h2>Related Images</h2>
  <div id="related-images" class="related-grid"></div>
</section>

<script>
const API_BASE = "https://api.pixeora.com";

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

// LOAD MAIN IMAGE
async function loadPhoto() {
  const res = await fetch(`${API_BASE}/api/images/${id}`);
  const img = await res.json();

  // SET IMAGE
  document.getElementById("main-image").src =
    `https://cdn.pixeora.com/${img.fileName}`;

  // TITLE
  document.getElementById("photo-title").textContent = img.title;

  // DESCRIPTION
  document.getElementById("photo-description").textContent =
    img.description || "";

  // TAGS
  const tagBox = document.getElementById("tag-box");
  if (img.tags && img.tags.length) {
    img.tags.forEach(tag => {
      tagBox.innerHTML += `<span class="tag">${tag}</span>`;
    });
  }

  // DOWNLOAD BUTTON
  document.getElementById("download-btn").onclick = () => {
    window.location.href =
      `${API_BASE}/api/images/download/${encodeURIComponent(img.fileName)}`;
  };

  // LOAD RELATED
  loadRelated(img.category || img.tags[0] || img.title.split(" ")[0]);
}

loadPhoto();


// RELATED IMAGES
async function loadRelated(keyword) {
  const res = await fetch(
    `${API_BASE}/api/images/search?q=${encodeURIComponent(keyword)}`
  );

  const data = await res.json();
  const container = document.getElementById("related-images");

  data.slice(0, 15).forEach(img => {
    const fileUrl = `https://cdn.pixeora.com/${encodeURIComponent(img.thumbnailFileName || img.fileName)}`;

    container.innerHTML += `
      <a href="photo.html?id=${img._id}" class="related-item">
        <img src="${fileUrl}" alt="">
      </a>
    `;
  });
}
</script>

</body>
</html>
