<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

  <!-- BASIC SEO -->
  <title>Search Free HD Wallpapers & Stock Images | Pixeora</title>

  <meta name="robots" content="index, follow">
  <meta name="description"
        content="Search millions of free HD wallpapers, 4K backgrounds, and royalty-free stock images. Fast results for USA, UK, Canada, Australia, Germany, India and more.">

  <meta name="keywords"
        content="search free images, hd wallpapers search, 4k wallpaper search, stock photos search, royalty free image search, commercial use photos, nature wallpapers, business images, technology wallpapers, travel stock photos, free image search engine, Pixeora search">

  <link rel="canonical" href="https://pixeora.com/search.html">

  <!-- PERFORMANCE -->
  <link rel="preload" href="css/search.css" as="style">
  <link rel="stylesheet" href="css/search.css">
  <link rel="stylesheet" href="css/cookie.css">

  <!-- Preconnect -->
  <link rel="preconnect" href="https://cdn.pixeora.com" crossorigin>
  <link rel="preconnect" href="https://api.pixeora.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- DNS Prefetch -->
  <link rel="dns-prefetch" href="https://cdn.pixeora.com">
  <link rel="dns-prefetch" href="https://api.pixeora.com">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Marck+Script&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Onest:wght@900&display=swap" rel="stylesheet">

  <!-- Favicons (Google SERP friendly) -->
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="apple-touch-icon" href="/favicon-32x32.png">

  <!-- Open Graph (STATIC – SAFE) -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Pixeora Search - Free HD Images & Wallpapers">
  <meta property="og:description" content="Search beautiful HD wallpapers and free stock photos from any category.">
  <meta property="og:url" content="https://pixeora.com/search.html">
  <meta property="og:image" content="https://pixeora.com/images/og-image.jpg">

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "url": "https://pixeora.com/",
    "name": "Pixeora",
    "logo": "https://pixeora.com/images/logo.png"
  }
  </script>

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SearchResultsPage",
    "name": "Pixeora Image Search",
    "description": "Search high-quality HD wallpapers, 4K images, and free stock photos by category or keyword.",
    "url": "https://pixeora.com/search.html"
  }
  </script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VPX3GGRR7H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-VPX3GGRR7H');
  </script>
</head>

<!-- Header -->
<header class="header">
  <div class="header-overlay">

    <a href="index.html" class="logo">Pixeora</a>

    <div class="search-bar-wrapper">
      <div class="search-bar-border">
        <form class="search-bar" onsubmit="return redirectSearch()">
          <input type="text" id="searchInput" placeholder="Search Image" required>
          <button type="submit" class="search-icon">
            <img src="images/search-icon.png" alt="Search">
          </button>
        </form>
      </div>
    </div>

    <a href="legal.html" class="legal-link-header">Legal & Policies</a>
  </div>
</header>

<!-- Search Info -->
<div class="search-info">
  <p>Showing Results for</p>
  <h1><span class="keyword">""</span></h1>
  <div class="image-count" id="image-count">0 Images</div>
</div>

<button id="goTopBtn" aria-label="Go to top">
  <svg class="arrow-icon" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M8 5l8 7-8 7" />
  </svg>
</button>

<!-- Gallery -->
<section class="search-results">
  <div class="masonry-grid" id="masonry">
    <div class="masonry-col"></div>
    <div class="masonry-col"></div>
    <div class="masonry-col"></div>
    <div class="masonry-col"></div>
  </div>
</section>

<div class="related-section" id="related-section" style="display:none;">
  <h2>Explore More</h2>

  <div class="related-masonry" id="related-images">
    <div class="related-col"></div>
    <div class="related-col"></div>
    <div class="related-col"></div>
    <div class="related-col"></div>
    <div class="related-col"></div> <!-- ⭐ 5 columns -->
  </div>
</div>

<div class="load-more-wrapper" id="loadMoreSection" style="display:none;">
  <button class="load-more-btn" onclick="loadMoreImages()">Load More</button>
</div>


<div id="cookie-banner" class="premium-cookie">
  <div class="cookie-content">
    <p class="cookie-message">
      We use cookies to enhance your browsing experience and analyze traffic.
    </p>
    <button id="cookie-accept" class="cookie-btn-premium">Got it</button>
  </div>
</div>

<script>
const API_BASE = "https://api.pixeora.com";

const params = new URLSearchParams(window.location.search);
const query = params.get("query") || params.get("q");

const keywordSpan = document.querySelector(".keyword");
const imageCountDiv = document.getElementById("image-count");

const relatedSection = document.getElementById("related-section");
const relatedContainer = document.getElementById("related-images");

/* MAIN MASONRY */
const masonry = document.getElementById("masonry");
const cols = Array.from(masonry.querySelectorAll(".masonry-col"));
let colIndex = 0;

/* Search Pagination */
let nextCursor = null;
let totalImages = 0;

/* DOWNLOAD */
function downloadImage(rawName) {
  const url = `${API_BASE}/api/images/download/${encodeURIComponent(rawName)}`;
  window.location.href = url;
}

/* DELEGATED DOWNLOAD */
document.addEventListener("click", (ev) => {
  const overlay = ev.target.closest && ev.target.closest(".download-overlay");
  if (overlay) {
    ev.stopImmediatePropagation();
    ev.preventDefault();
    const raw = overlay.getAttribute("data-file");
    if (raw) downloadImage(raw);
    return;
  }
}, true);

/* CARD TEMPLATE */
function createCard(img) {
  const div = document.createElement("div");
  div.classList.add("image-item");

  const file = img.thumbnailFileName || img.fileName || "";
  const url = `https://cdn.pixeora.com/${encodeURIComponent(file)}`;
  const safeFileAttr = String(img.fileName || "").replace(/"/g, "&quot;");

  div.innerHTML = `
    <div class="image-wrapper" style="position:relative;">
      <div class="skeleton"></div>
      <a href="/photo/${img.slug || ""}-${img._id || ""}" class="image-link">
        <img 
          data-src="${url}" 
          class="lazy-img image-load"
          alt="${(img.alt || img.title || "")}"
        >
      </a>
      <span class="download-overlay" data-file="${safeFileAttr}"></span>
    </div>
  `;
  return div;
}

/* COLUMN INSERT */
function addToNextColumn(card) {
  cols[colIndex].appendChild(card);
  colIndex = (colIndex + 1) % cols.length;
}

/* LAZY LOAD */
function lazyLoadInit() {
  const lazyImages = document.querySelectorAll("img.lazy-img");
  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) return;

      const img = entry.target;
      img.src = img.dataset.src;

      img.onload = () => {
        img.classList.add("image-loaded");
        const sk = img.closest(".image-wrapper")?.querySelector(".skeleton");
        if (sk) sk.remove();
      };

      img.classList.remove("lazy-img");
      obs.unobserve(img);
    });
  }, { rootMargin: "400px 0px" });

  lazyImages.forEach(img => observer.observe(img));
}

function applyImageLoadAnimation() {
  document.querySelectorAll(".image-load").forEach(img => {
    img.onload = () => {
      img.classList.add("image-loaded");
      const sk = img.closest(".image-wrapper")?.querySelector(".skeleton");
      if (sk) sk.remove();
    };
  });
}

/* LOAD FIRST SEARCH RESULTS */
async function loadSearchFirst(q) {
  try {
    const res = await fetch(
      `${API_BASE}/api/search/first?q=${encodeURIComponent(q)}&limit=50`
    );
    const data = await res.json();

    const images = data.images || [];
    nextCursor = data.nextCursor;
    totalImages = data.total || images.length;

    imageCountDiv.textContent = `${totalImages} Images`;

    cols.forEach(c => (c.innerHTML = ""));
    colIndex = 0;

    if (!images.length) {
      masonry.innerHTML = "<p>No images found.</p>";
      loadRelatedInitial(q);
      return;
    }

    relatedSection.style.display = "none";

    images.forEach(img => addToNextColumn(createCard(img)));

    lazyLoadInit();
    applyImageLoadAnimation();

    toggleLoadMore();

  } catch (err) {
    console.error(err);
  }
}

/* LOAD NEXT SEARCH RESULTS */
async function loadSearchNext() {
  if (!nextCursor) return;

  const res = await fetch(
    `${API_BASE}/api/search/next?q=${encodeURIComponent(query)}&cursor=${nextCursor}&limit=50`
  );
  const data = await res.json();
  const images = data.images || [];

  nextCursor = data.nextCursor;

  images.forEach(img => addToNextColumn(createCard(img)));

  lazyLoadInit();
  applyImageLoadAnimation();
  toggleLoadMore();
}

/* LOAD MORE BUTTON */
function toggleLoadMore() {
  const section = document.getElementById("loadMoreSection");
  if (nextCursor === null) {
    section.style.display = "none";
  } else {
    section.style.display = "block";
  }
}

function loadMoreImages() {
  loadSearchNext();
}

/* RELATED FALLBACK */
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

let relatedAll = [];
let relatedIndex = 0;
const RELATED_BATCH = 30;

async function loadRelatedInitial(keyword) {
  relatedSection.style.display = "block";

  const r = await fetch(`${API_BASE}/api/images/popular-latest?limit=200`);
  const pop = await r.json();
  relatedAll = pop.images || [];

  relatedAll = shuffle(relatedAll);
  relatedIndex = 0;
  loadNextRelatedBatch();
}

function loadNextRelatedBatch() {
  const relatedCols = relatedContainer.querySelectorAll(".related-col");
  const batch = relatedAll.slice(relatedIndex, relatedIndex + RELATED_BATCH);
  if (!batch.length) return;

  let col = 0;
  batch.forEach(img => {
    const card = createCard(img);
    relatedCols[col].appendChild(card);
    col = (col + 1) % relatedCols.length;
  });

  relatedIndex += RELATED_BATCH;
  lazyLoadInit();
  applyImageLoadAnimation();
}

window.addEventListener("scroll", () => {
  if (relatedSection.style.display === "block") {
    const rect = relatedSection.getBoundingClientRect();
    if (rect.bottom - window.innerHeight < 600) {
      loadNextRelatedBatch();
    }
  }
});

/* SEARCH REDIRECT */
function redirectSearch() {
  const q = document.getElementById("searchInput").value.trim();
  if (q) window.location.href = `search.html?query=${encodeURIComponent(q)}`;
  return false;
}

/* START */
if (query) {
  keywordSpan.textContent = `"${query[0].toUpperCase() + query.slice(1)}"`;
  loadSearchFirst(query);
}
/* ================= Top Button ================= */
const goTopBtn = document.getElementById("goTopBtn");

window.addEventListener("scroll", () => {
  if (window.scrollY > 400) {
    goTopBtn.style.display = "flex";
    goTopBtn.style.opacity = "1";
  } else {
    goTopBtn.style.opacity = "0";
    setTimeout(() => {
      if (window.scrollY < 400) {
        goTopBtn.style.display = "none";
      }
    }, 300);
  }
});

goTopBtn.addEventListener("click", () => {
  window.scrollTo({
    top: 0,
    behavior: "smooth"
  });
});

/* COOKIE */
document.addEventListener("DOMContentLoaded", function () {
  const banner = document.getElementById("cookie-banner");
  const acceptBtn = document.getElementById("cookie-accept");

  if (!localStorage.getItem("cookieConsent")) {
    setTimeout(() => {
      banner.classList.add("show");
    }, 500);
  }

  acceptBtn.addEventListener("click", () => {
    localStorage.setItem("cookieConsent", "true");
    banner.classList.remove("show");
  });
});
</script>
