<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- =========================
       SEO + TITLE
  ========================== -->
  <title>Search Free HD Wallpapers & Stock Images | Pixeora</title>

  <meta name="description" 
        content="Search millions of free HD wallpapers, 4K backgrounds, and royalty-free stock images. Fast results for USA, UK, Canada, Australia, Germany, India and more.">

  <meta name="keywords" 
        content="search free images, hd wallpapers search, 4k wallpaper search, stock photos search, royalty free image search, commercial use photos, nature wallpapers, business images, technology wallpapers, travel stock photos, free image search engine, Pixeora search">

  <link rel="canonical" href="https://pixeora.com/search.html">

  <!-- =========================
       PERFORMANCE BOOST
  ========================== -->
  <!-- Preload CSS -->
  <link rel="preload" href="css/search.css" as="style">
  <link rel="stylesheet" href="css/search.css">

  <!-- CDN -->
  <link rel="preconnect" href="https://cdn.pixeora.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.pixeora.com">

  <!-- API -->
  <link rel="preconnect" href="https://api.pixeora.com" crossorigin>
  <link rel="dns-prefetch" href="https://api.pixeora.com">

  <!-- Google Fonts Optimization -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Marck+Script&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Onest:wght@900&display=swap" rel="stylesheet">

  <!-- =========================
       SOCIAL SHARING TAGS
  ========================== -->
  <meta property="og:title" content="Pixeora Search - Free HD Images & Wallpapers">
  <meta property="og:description" content="Search beautiful HD wallpapers and free stock photos from any category.">
  <meta property="og:image" content="https://pixeora.com/images/og-image.jpg">
  <meta property="og:url" content="https://pixeora.com/search.html">
  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Search Free HD Wallpapers & Images | Pixeora">
  <meta name="twitter:description" content="Search and download HD wallpapers, 4K backgrounds, and royalty-free stock images.">
  <meta name="twitter:image" content="https://pixeora.com/images/og-image.jpg">

  <!-- =========================
       STRUCTURED DATA (SEO BOOST)
  ========================== -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SearchResultsPage",
    "name": "Pixeora Image Search",
    "description": "Search high-quality HD wallpapers, 4K images, and free stock photos by category or keyword.",
    "url": "https://pixeora.com/search.html"
  }
  </script>

</head>

<!-- Header -->
<header class="header">
  <div class="header-overlay">

    <a href="index.html" class="logo">Pixeora</a>

    <div class="search-bar-wrapper">
      <div class="search-bar-border">
        <form class="search-bar" onsubmit="return redirectSearch()">
          <input type="text" id="searchInput" placeholder="Search Image" required>
          <button type="submit" class="search-icon">
            <img src="images/search-icon.png" alt="Search">
          </button>
        </form>
      </div>
    </div>

    <a href="legal.html" class="legal-link-header">Legal & Policies</a>
  </div>
</header>

<!-- Search Info -->
<div class="search-info">
  <p>Showing Results for</p>
  <h1><span class="keyword">""</span></h1>
  <div class="image-count" id="image-count">0 Images</div>
</div>

<!-- Gallery -->
<section class="search-results">
  <div class="masonry-grid" id="masonry">
    <div class="masonry-col"></div>
    <div class="masonry-col"></div>
    <div class="masonry-col"></div>
    <div class="masonry-col"></div>
  </div>
</section>

<div class="related-section" id="related-section" style="display:none;">
  <h2>Explore More</h2>

  <div class="related-masonry" id="related-images">
    <div class="related-col"></div>
    <div class="related-col"></div>
    <div class="related-col"></div>
    <div class="related-col"></div>
    <div class="related-col"></div> <!-- ⭐ 5 columns -->
  </div>
</div>


<script>
const API_BASE = "https://api.pixeora.com";

const params = new URLSearchParams(window.location.search);
const query = params.get("query");

const keywordSpan = document.querySelector(".keyword");
const imageCountDiv = document.getElementById("image-count");

const relatedSection = document.getElementById("related-section");
const relatedContainer = document.getElementById("related-images");

/* MAIN MASONRY */
const masonry = document.getElementById("masonry");
const cols = Array.from(masonry.querySelectorAll(".masonry-col"));
let colIndex = 0;

/* DOWNLOAD */
function downloadImage(rawName) {
  const url = `${API_BASE}/api/images/download/${encodeURIComponent(rawName)}`;
  window.location.href = url;
}

/* BLOCK ANCHOR CLICK WHEN CLICKING DOWNLOAD ICON */
document.addEventListener("click", (ev) => {
  if (ev.target.classList.contains("download-overlay")) {
    ev.stopPropagation();
    ev.preventDefault();
  }
}, true);

/* FIX: Ensure clicking the image still opens photo page */
document.addEventListener("click", (ev) => {
  const img = ev.target;

  // Only handle image clicks inside image-wrapper
  if (img.tagName === "IMG" && img.closest(".image-wrapper")) {

    // If user clicked the download icon → ignore
    if (img.classList.contains("download-overlay")) return;

    // PHOTO PAGE NAVIGATION HANDLED BY <a> (default)
    // No blocking required
  }
}, true);

/* UNIVERSAL CARD (Search + Related) */
function createCard(img) {
  const div = document.createElement("div");
  div.classList.add("image-item");

  const file = img.thumbnailFileName || img.fileName;
  const url = `https://cdn.pixeora.com/${encodeURIComponent(file)}`;

  div.innerHTML = `
    <div class="image-wrapper" style="position:relative;">
      <div class="skeleton"></div>

      <a href="/photo/${img.slug}-${img._id}" class="image-link">
        <img 
          data-src="${url}" 
          class="lazy-img image-load"
          alt="${img.alt || img.title || ""}"
        >
      </a>

      <span class="download-overlay"
        onclick="event.stopImmediatePropagation(); event.preventDefault(); downloadImage('${img.fileName.replace(/'/g,"\\'")}')">
      </span>
    </div>
  `;

  return div;
}

/* ADD MAIN COLUMN */
function addToNextColumn(card) {
  cols[colIndex].appendChild(card);
  colIndex = (colIndex + 1) % cols.length;
}

/* LAZY LOAD */
function lazyLoadInit() {
  const lazyImages = document.querySelectorAll("img.lazy-img");

  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) return;

      const img = entry.target;
      img.src = img.dataset.src;

      img.onload = () => {
        img.classList.add("image-loaded");
        const sk = img.closest(".image-wrapper").querySelector(".skeleton");
        if (sk) sk.remove();
      };

      img.classList.remove("lazy-img");
      obs.unobserve(img);
    });
  });

  lazyImages.forEach(img => observer.observe(img));
}

function applyImageLoadAnimation() {
  document.querySelectorAll(".image-load").forEach(img => {
    img.onload = () => {
      img.classList.add("image-loaded");
      const sk = img.closest(".image-wrapper")?.querySelector(".skeleton");
      if (sk) sk.remove();
    };
  });
}

/* LOAD MAIN SEARCH RESULTS */
async function loadSearchImages(q) {
  try {
    const res = await fetch(`${API_BASE}/api/search?q=${encodeURIComponent(q)}`);
    let images = await res.json();

    imageCountDiv.textContent = `${images.length} Images`;

    cols.forEach(c => (c.innerHTML = ""));
    colIndex = 0;

    if (!images.length) {
      masonry.innerHTML = "<p>No images found.</p>";
      relatedSection.style.display = "block";
      loadRelatedInitial(q);
      return;
    }

    relatedSection.style.display = "none";

    images.forEach(img => {
      addToNextColumn(createCard(img));
    });

    lazyLoadInit();
    applyImageLoadAnimation();

  } catch (err) {
    console.error(err);
  }
}

/* SHUFFLE */
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

/* -------------------------
   RELATED SECTION PAGINATION
---------------------------*/

let relatedAll = [];
let relatedIndex = 0;
const RELATED_BATCH = 30;

async function loadRelatedInitial(keyword) {
  relatedSection.style.display = "block";

  const res = await fetch(`${API_BASE}/api/search?q=${encodeURIComponent(keyword)}`);
  relatedAll = await res.json();

  if (!relatedAll.length) {
    const r = await fetch(`${API_BASE}/api/images/popular?page=1&limit=200`);
    relatedAll = (await r.json()).images || [];
  }

  relatedAll = shuffle(relatedAll);

  relatedIndex = 0;
  loadNextRelatedBatch();
}

/* LOAD NEXT 30 RELATED IMAGES */
function loadNextRelatedBatch() {
  const relatedCols = relatedContainer.querySelectorAll(".related-col");

  const batch = relatedAll.slice(relatedIndex, relatedIndex + RELATED_BATCH);
  if (!batch.length) return;

  let col = 0;
  batch.forEach(img => {
    const card = createCard(img); 
    relatedCols[col].appendChild(card);
    col = (col + 1) % relatedCols.length;
  });

  relatedIndex += RELATED_BATCH;

  lazyLoadInit();
  applyImageLoadAnimation();
}

/* INFINITY SCROLL TRIGGER */
window.addEventListener("scroll", () => {
  if (relatedSection.style.display === "block") {
    const rect = relatedSection.getBoundingClientRect();
    if (rect.bottom - window.innerHeight < 600) {
      loadNextRelatedBatch();
    }
  }
});

/* SEARCH REDIRECT */
function redirectSearch() {
  const q = document.getElementById("searchInput").value.trim();
  if (q) window.location.href = `search.html?query=${encodeURIComponent(q)}`;
  return false;
}

/* START */
if (query) {
  keywordSpan.textContent = `"${query.charAt(0).toUpperCase() + query.slice(1)}"`;
  loadSearchImages(query);
}
</script>
